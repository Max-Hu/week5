<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>My Bookmarks</title>
<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
<link rel="stylesheet" type="text/css" href="stylesheets/styles.css">

<script type="text/javascript">
$(function(){

      var lowerCase = new Array();
      var $jsontip = $("#jsonTip");
    // $("#btn").click(function(){
      $.getJSON("data/bookmarks.json",function(data){
        var strHtml = "";//存储数据的变量
        $jsontip.empty();//清空内容
        $.each(data,function(infoIndex,info){
          var myDate = new Date( info["created"] *1000);
          var realtime = myDate.toLocaleString();
          strHtml +="<div>";
          strHtml += "<div class=\'title\'>"+info["title"]+"</div>";
          strHtml += "<div class=\'time\'>"+"Created @ "+realtime+"</div>";
          strHtml +="</div>";
          strHtml += "<hr class=\'hr\'>"
          info = _.mapObject(info, function(val, key) {
              return val.toLowerCase();
          });
          lowerCase.push(info);
        })
        $jsontip.html(strHtml);//显示处理后的数据
      });

// })
    $("#textbox").keyup(function(){
      var value = $(this).val();
      $jsontip.empty();
      // var test = _.filter(lowerCase, function(object,infoIndex){
      //   return object.title.indexOf(value); });
      $.getJSON("data/bookmarks.json",function(data){
          var strHtml = "";
          $.each(lowerCase,function(infoIndex,info){
              if (info["title"].indexOf(value.toLowerCase()) !=-1) {
                var myDate = new Date( info["created"] *1000);
                var realtime = myDate.toLocaleString();
                var position = info["title"].indexOf(value.toLowerCase());
                var defaultTitle = data[infoIndex].title;
                var title =  defaultTitle.substring(0,position) + "<mark>";
                title +=defaultTitle.substring(position,position+value.length) + "</mark>";
                title += defaultTitle.substring(position+value.length,data[infoIndex].length);
                strHtml +="<div>";
                strHtml += "<div class=\'title\'>"+title+"</div>";
                strHtml += "<div class=\'time\'>"+"Created @ "+realtime+"</div>";
                strHtml +="</div>";
                strHtml += "<hr class=\'hr\'>"
              }
            })
            $jsontip.html(strHtml);
    });
    });
})
</script>
</head>
<body>
<div id="divframe">
<div class="loadTitle">
<input type="text"  value="" class="search" id="textbox">
</div>
<div id="jsonTip" class="contant">
</div>
</div>
</body>
</html>
